<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls-component-2/dist/aframe-orbit-controls-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.min.js"></script>
</head>
<body>
  <a-scene>
    <!-- Cámara con controles de mirada y orbitales -->
    <a-entity camera look-controls orbit-controls="
        target: 0 0 0;
        minDistance: 1;
        maxDistance: 10;
        initialPosition: 0 0 5;
        enableDamping: true;
        dampingFactor: 0.25;
        rotateSpeed: 0.1;"></a-entity>
    
    <!-- Componente para la detección de códigos QR -->
    <a-entity id="qrScanner" qr-scanner></a-entity>
    
    <!-- Un plano para que podamos ver algo -->
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
  </a-scene>

  <script>
    AFRAME.registerComponent('qr-scanner', {
      init: function () {
        const video = document.createElement('video');
        const canvasElement = document.createElement('canvas');
        const canvas = canvasElement.getContext('2d');
        
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
          .then(function(stream) {
            video.srcObject = stream;
            video.setAttribute('playsinline', true); // required to tell iOS safari we don't want fullscreen
            video.play();
            requestAnimationFrame(tick);
          });

        function tick() {
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            canvasElement.hidden = false;
            canvasElement.height = video.videoHeight;
            canvasElement.width = video.videoWidth;
            canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
            const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            if (code) {
              console.log('QR code detected:', code.data);
              // Aquí puedes procesar el código QR y mostrar la información asociada en la escena
            } else {
              console.log('No QR code detected');
            }
          }
          requestAnimationFrame(tick);
        }
      }
    });
  </script>
</body>
</html>
